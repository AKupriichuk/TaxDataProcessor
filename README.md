# üõ† Technical Documentation: Tax Data Processor

### üèó Architecture Overview

–°–∏—Å—Ç–µ–º–∞ –ø–æ–±—É–¥–æ–≤–∞–Ω–∞ –∑–∞ –º–æ–¥—É–ª—å–Ω–∏–º –ø—Ä–∏–Ω—Ü–∏–ø–æ–º –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–æ—Å—Ç—ñ —Ç–∞ –ª–µ–≥–∫–æ–≥–æ —Å—É–ø—Ä–æ–≤–æ–¥—É:

* **Data Ingestion Layer**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `pathlib` –¥–ª—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π —Ç–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–∂–µ—Ä–µ–ª (Stripe/PayPal) –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —à–ª—è—Ö—ñ–≤.
* **Processing Engine**: –†–æ–∑–¥—ñ–ª–µ–Ω–∏–π –Ω–∞ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –º–æ–¥—É–ª—ñ (`paypal_processor`, `stripe_processor`). –¶–µ –¥–æ–∑–≤–æ–ª—è—î —ñ–∑–æ–ª—é–≤–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –ø–∞—Ä—Å–∏–Ω–≥—É —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö —Ñ–æ—Ä–º–∞—Ç—ñ–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, T-–∫–æ–¥–∏ PayPal) –≤—ñ–¥ –∑–∞–≥–∞–ª—å–Ω–æ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏.
* **Utility Layer**: –ú—ñ—Å—Ç–∏—Ç—å —Å–ø—ñ–ª—å–Ω—É –ª–æ–≥—ñ–∫—É –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –ü–î–í —Ç–∞ —Ä–æ–±–æ—Ç–∏ –∑ —á–∞—Å–æ–≤–∏–º–∏ —Ä—è–¥–∞–º–∏ –∫—É—Ä—Å—ñ–≤ –≤–∞–ª—é—Ç.

### ‚ö° Technical Optimizations & Decisions

* **Vectorized Operations**: –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ü–î–í —Ç–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –≤–∞–ª—é—Ç —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ `pandas` (–º–∞—Å–∫–∏ —Ç–∞ –≤–µ–∫—Ç–æ—Ä–Ω–µ –º–Ω–æ–∂–µ–Ω–Ω—è), —â–æ –∑–Ω–∞—á–Ω–æ —à–≤–∏–¥—à–µ –∑–∞ —ñ—Ç–µ—Ä–∞—Ü—ñ—é —Ä—è–¥–∫—ñ–≤.
* **O(1) Rate Lookup**: –î–ª—è –≤–µ–ª–∏–∫–∏—Ö –º–∞—Å–∏–≤—ñ–≤ –¥–∞–Ω–∏—Ö (Stripe) –∑–∞–º—ñ—Å—Ç—å –ø–æ—Å—Ç—ñ–π–Ω–æ—ó —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó `DataFrame` –∫—É—Ä—Å—ñ–≤ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –∫–µ—à—É–≤–∞–Ω–Ω—è —É `dict`. –¶–µ –∑–∞–±–µ–∑–ø–µ—á—É—î –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–∏–π —á–∞—Å –ø–æ—à—É–∫—É –∫—É—Ä—Å—É –∑–∞ –ø–∞—Ä–æ—é `(Date, Currency)`.
* **Format Normalization**: –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–∞–≤–æ–∫ –ü–î–í (–ø—ñ–¥—Ç—Ä–∏–º–∫–∞ `0.21` —Ç–∞ `21.0`) —Ç–∞ –æ—á–∏—â–µ–Ω–Ω—è –≤—Ö—ñ–¥–Ω–∏—Ö —á–∏—Å–ª–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –≤—ñ–¥ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö —Å–∏–º–≤–æ–ª—ñ–≤.
* **UID File Tracking**: –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä—É—î —É–Ω—ñ–∫–∞–ª—å–Ω—ñ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –≤–∏—Ö—ñ–¥–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö (Month + Entity), —â–æ –≤–∏—Ä—ñ—à—É—î –ø—Ä–æ–±–ª–µ–º—É –∫–æ–ª—ñ–∑—ñ–π –ø—Ä–∏ –æ–¥–Ω–∞–∫–æ–≤—ñ–π –Ω–∞–∑–≤—ñ –≤—Ö—ñ–¥–Ω–∏—Ö CSV.

### üß™ Quality Assurance (QA)

–ü—Ä–æ–µ–∫—Ç –ø–æ–∫—Ä–∏—Ç–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏ –Ω–∞ –±–∞–∑—ñ `pytest`:

1. **Reconciliation Test**: –ü–æ–≤–Ω–∞ –∑–≤—ñ—Ä–∫–∞ —Å—É–º `in_total` vs `out_total` –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —ñ–Ω–≤–µ—Ä—Å—ñ—ó –∑–Ω–∞–∫—ñ–≤ –¥–ª—è Refunds/Chargebacks. –î–æ–ø—É—Å—Ç–∏–º–∞ –¥–µ–ª—å—Ç–∞ < 1.0 (–∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ –≤—Ç—Ä–∞—Ç–∏ –¥–∞–Ω–∏—Ö).
2. **Tax Logic Validation**: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–∏—Ö —Å—Ç–∞–≤–æ–∫ –ü–î–í –∑–∞–∫–æ–Ω–æ–¥–∞–≤—á–∏–º –Ω–æ—Ä–º–∞–º –≤–∫–∞–∑–∞–Ω–∏—Ö –∫—Ä–∞—ó–Ω –Ñ–°.
3. **Mapping Coverage**: –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–æ–≤–Ω–æ—Ç–∏ –∑–±–∞–≥–∞—á–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö (Project & Legal Entity mapping).
   <img width="884" height="479" alt="image" src="https://github.com/user-attachments/assets/f0920ccc-c348-4154-8a7f-39d5fec8640f" />


### üì¶ Installation & Setup

1. Clone the repository.
2. Install dependencies: `pip install requirements.txt`.
3. Run main script: `python main.py`.

